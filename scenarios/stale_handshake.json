{
  "name": "Stale Handshake Detection",
  "description": "Device remains in range but handshake becomes stale (>60 seconds). System should detect and reconnect to refresh profile data.",
  "devices": [
    {
      "id": "ios-device-1",
      "platform": "ios",
      "device_name": "iPhone 14",
      "profile": {
        "first_name": "Charlie",
        "photo_hash": "old_hash_123"
      }
    },
    {
      "id": "android-device-1",
      "platform": "android",
      "device_name": "Samsung Galaxy S23",
      "profile": {
        "first_name": "Diana",
        "photo_hash": "photo_456"
      }
    }
  ],
  "timeline": [
    {
      "time_ms": 0,
      "action": "start_advertising",
      "device": "android-device-1"
    },
    {
      "time_ms": 100,
      "action": "start_scanning",
      "device": "ios-device-1"
    },
    {
      "time_ms": 200,
      "action": "discover",
      "device": "ios-device-1",
      "target": "android-device-1"
    },
    {
      "time_ms": 250,
      "action": "connect",
      "device": "ios-device-1",
      "target": "android-device-1"
    },
    {
      "time_ms": 300,
      "action": "send_handshake",
      "device": "ios-device-1"
    },
    {
      "time_ms": 350,
      "action": "send_handshake",
      "device": "android-device-1"
    },
    {
      "time_ms": 400,
      "action": "disconnect",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "Connection ends after handshake exchange"
    },
    {
      "time_ms": 5000,
      "action": "discover",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "Periodic scan result (duplicate callback) at 5 seconds"
    },
    {
      "time_ms": 10000,
      "action": "discover",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "Another scan result at 10 seconds"
    },
    {
      "time_ms": 60500,
      "action": "discover",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "Scan result after handshake is stale (>60s)"
    },
    {
      "time_ms": 60600,
      "action": "update_profile",
      "device": "android-device-1",
      "data": {
        "first_name": "Diana Updated",
        "photo_hash": "new_photo_789"
      },
      "comment": "Android user updated their profile during the 60 seconds"
    },
    {
      "time_ms": 60700,
      "action": "connect",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "iOS reconnects because handshake is stale"
    },
    {
      "time_ms": 60800,
      "action": "send_handshake",
      "device": "ios-device-1"
    },
    {
      "time_ms": 60850,
      "action": "send_handshake",
      "device": "android-device-1",
      "comment": "New handshake with updated profile"
    }
  ],
  "assertions": [
    {
      "type": "handshake_received",
      "device": "ios-device-1",
      "from": "android-device-1",
      "data": {
        "first_name": "Diana",
        "photo_hash": "photo_456"
      },
      "comment": "Initial handshake"
    },
    {
      "type": "stale_handshake",
      "device": "ios-device-1",
      "data": {
        "age_seconds": 60
      },
      "comment": "Handshake detected as stale"
    },
    {
      "type": "reconnected",
      "device": "ios-device-1",
      "to": "android-device-1",
      "comment": "Automatic reconnection triggered"
    },
    {
      "type": "handshake_received",
      "device": "ios-device-1",
      "from": "android-device-1",
      "data": {
        "first_name": "Diana Updated",
        "photo_hash": "new_photo_789"
      },
      "comment": "Fresh handshake with updated profile data"
    },
    {
      "type": "photo_transfer_started",
      "from": "android-device-1",
      "to": "ios-device-1",
      "comment": "New photo hash triggers photo transfer"
    }
  ]
}
