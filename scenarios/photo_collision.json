{
  "name": "Photo Send Collision - iOS vs Android",
  "description": "Two devices try to send photos simultaneously. Tie-breaker logic resolves collision based on device name comparison.",
  "devices": [
    {
      "id": "ios-device-1",
      "platform": "ios",
      "device_name": "iPhone 15 Pro",
      "profile": {
        "first_name": "Alice",
        "last_name": "Smith",
        "photo_hash": "abc123def456",
        "photo_path": "testdata/alice_photo.jpg"
      },
      "advertising": {
        "service_uuids": ["E621E1F8-C36C-495A-93FC-0C247A3E6E5F"],
        "interval_ms": 100,
        "tx_power": 0
      }
    },
    {
      "id": "android-device-1",
      "platform": "android",
      "device_name": "Pixel 8 Pro",
      "profile": {
        "first_name": "Bob",
        "last_name": "Jones",
        "photo_hash": "xyz789uvw012",
        "photo_path": "testdata/bob_photo.jpg"
      },
      "advertising": {
        "service_uuids": ["E621E1F8-C36C-495A-93FC-0C247A3E6E5F"],
        "interval_ms": 100,
        "tx_power": 0
      }
    }
  ],
  "timeline": [
    {
      "time_ms": 0,
      "action": "start_advertising",
      "device": "android-device-1",
      "comment": "Android starts advertising first"
    },
    {
      "time_ms": 50,
      "action": "start_advertising",
      "device": "ios-device-1",
      "comment": "iOS also advertising (dual role)"
    },
    {
      "time_ms": 100,
      "action": "start_scanning",
      "device": "ios-device-1",
      "comment": "iOS scans for peripherals"
    },
    {
      "time_ms": 200,
      "action": "discover",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "iOS discovers Android"
    },
    {
      "time_ms": 250,
      "action": "connect",
      "device": "ios-device-1",
      "target": "android-device-1",
      "comment": "iOS connects as Central"
    },
    {
      "time_ms": 300,
      "action": "discover_services",
      "device": "ios-device-1"
    },
    {
      "time_ms": 400,
      "action": "send_handshake",
      "device": "ios-device-1",
      "comment": "iOS sends handshake with txPhotoHash"
    },
    {
      "time_ms": 450,
      "action": "receive_handshake",
      "device": "android-device-1",
      "comment": "Android receives handshake"
    },
    {
      "time_ms": 500,
      "action": "send_handshake",
      "device": "android-device-1",
      "comment": "Android sends handshake response"
    },
    {
      "time_ms": 550,
      "action": "receive_handshake",
      "device": "ios-device-1",
      "comment": "iOS receives handshake"
    },
    {
      "time_ms": 600,
      "action": "send_photo_metadata",
      "device": "ios-device-1",
      "comment": "Both devices detect different photo hashes and start sending SIMULTANEOUSLY"
    },
    {
      "time_ms": 600,
      "action": "send_photo_metadata",
      "device": "android-device-1",
      "comment": "Collision happens here!"
    },
    {
      "time_ms": 650,
      "action": "receive_photo_metadata",
      "device": "ios-device-1",
      "data": {
        "from": "android-device-1"
      },
      "comment": "iOS receives metadata while sending - collision detected"
    },
    {
      "time_ms": 650,
      "action": "receive_photo_metadata",
      "device": "android-device-1",
      "data": {
        "from": "ios-device-1"
      },
      "comment": "Android receives metadata while sending - collision detected"
    }
  ],
  "assertions": [
    {
      "type": "connected",
      "device": "ios-device-1",
      "to": "android-device-1"
    },
    {
      "type": "handshake_received",
      "device": "ios-device-1",
      "from": "android-device-1"
    },
    {
      "type": "handshake_received",
      "device": "android-device-1",
      "from": "ios-device-1"
    },
    {
      "type": "collision_detected",
      "device": "ios-device-1",
      "comment": "Both devices detect collision"
    },
    {
      "type": "collision_detected",
      "device": "android-device-1"
    },
    {
      "type": "collision_winner",
      "device": "android-device-1",
      "reason": "Pixel 8 Pro > iPhone 15 Pro (lexicographic comparison)",
      "comment": "Android wins tie-breaker and continues sending"
    },
    {
      "type": "collision_loser",
      "device": "ios-device-1",
      "comment": "iOS aborts send and switches to receiving"
    },
    {
      "type": "transfer_aborted",
      "device": "ios-device-1",
      "comment": "iOS stores aborted send state for retry"
    },
    {
      "type": "photo_transfer_completed",
      "from": "android-device-1",
      "to": "ios-device-1",
      "comment": "Android completes photo send to iOS"
    },
    {
      "type": "photo_transfer_completed",
      "from": "ios-device-1",
      "to": "android-device-1",
      "comment": "iOS retries and completes photo send after receiving"
    }
  ]
}
